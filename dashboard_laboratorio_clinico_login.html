<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard | Plus Laboratorio Cl√≠nico</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background:#f4f6f9; }
    .sidebar {
      width: 260px;
      min-height: 100vh;
      background: #1f2937;
      color: #fff;
    }
    .sidebar a {
      color: #cbd5e1;
      text-decoration: none;
      display: block;
      padding: 12px 20px;
      cursor: pointer;
    }
    .sidebar a:hover { background: #111827; color: #fff; }
    .hidden { display:none; }
  </style>
</head>
<body>

<div class="d-flex">

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h4 class="text-center py-3">üî¨ Plus Lab</h4>
    <a onclick="showSection('dashboard')">üìä Dashboard</a>
    <a onclick="showSection('citas')">üìÖ Citas</a>
    <a onclick="showSection('usuarios')">üë• Usuarios</a>
    <a onclick="showSection('pruebas')" id="menuPruebas">üß™ Pruebas</a>
    <a onclick="showSection('config')" id="menuConfig">‚öôÔ∏è Configuraci√≥n</a>
    <a onclick="logout()">üö™ Cerrar sesi√≥n</a>
  </div>

  <!-- CONTENIDO -->
  <div class="flex-fill p-4">

    <!-- DASHBOARD -->
    <div id="dashboard" class="section">
  <h3 class="mb-3">Bienvenido al Sistema</h3>
  <p>Panel de control del Laboratorio Cl√≠nico Plus.</p>

  <!-- GRAFICAS -->
  <div class="row g-4 mt-2">
    <div class="col-md-7">
      <div class="card p-3">
        <h6>Resultados Realizados (√öltimos 7 d√≠as)</h6>
        <canvas id="chartResultados"></canvas>
      </div>
    </div>

    <div class="col-md-5">
      <div class="card p-3">
        <h6>Resultados por Tipo de Examen</h6>
        <canvas id="chartTipos"></canvas>
      </div>
    </div>
  </div>
</div>

    <!-- CITAS -->
    <div id="citas" class="section hidden">
      <h4>Gesti√≥n de Citas</h4>
      <table class="table table-bordered">
        <thead><tr><th>Paciente</th><th>Fecha</th><th>Acciones</th></tr></thead>
        <tbody id="tablaCitas"></tbody>
      </table>
    </div>

    <!-- USUARIOS -->
    <div id="usuarios" class="section hidden">
      <h4>Usuarios Registrados</h4>
      <table class="table table-bordered">
        <thead><tr><th>C√©dula</th><th>Rol</th><th>Acciones</th></tr></thead>
        <tbody id="tablaUsuarios"></tbody>
      </table>
    </div>

    <!-- PRUEBAS -->
    <div id="pruebas" class="section hidden">
      <h4>Pruebas de Laboratorio</h4>
      <button class="btn btn-success mb-2" onclick="crearPrueba()">‚ûï Nueva Prueba</button>
      <ul id="listaPruebas" class="list-group"></ul>
    </div>

    <!-- CONFIG -->
    <div id="config" class="section hidden">
      <h4>Configuraci√≥n del Sistema</h4>
      <input class="form-control mb-2" placeholder="Nombre del Sistema">
      <input class="form-control mb-2" placeholder="Nombre Corto">
      <input type="file" class="form-control mb-2">
      <button class="btn btn-primary">Guardar Cambios</button>
    </div>

  </div>
</div>

<script>
  // Seguridad
  if (!localStorage.getItem('session')) location.href = 'login.html';

  const rol = localStorage.getItem('rol');

  // Datos simulados
  const citas = [
    { paciente: 'Juan P√©rez', fecha: '2026-02-05' },
    { paciente: 'Ana L√≥pez', fecha: '2026-02-06' }
  ];

  const usuarios = [
    { cedula: '123456789', rol: 'admin' },
    { cedula: '987654321', rol: 'staff' }
  ];

  const pruebas = ['Hemograma', 'Glucosa', 'Colesterol'];

  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
  }

  function logout() {
    localStorage.clear();
    location.href = 'login.html';
  }

  // Render citas
  const tablaCitas = document.getElementById('tablaCitas');
  citas.forEach(c => {
    tablaCitas.innerHTML += `<tr><td>${c.paciente}</td><td>${c.fecha}</td><td><button class='btn btn-sm btn-danger'>Eliminar</button></td></tr>`;
  });

  // Render usuarios
  const tablaUsuarios = document.getElementById('tablaUsuarios');
  usuarios.forEach(u => {
    tablaUsuarios.innerHTML += `<tr><td>${u.cedula}</td><td>${u.rol}</td><td><button class='btn btn-sm btn-danger'>Eliminar</button></td></tr>`;
  });

  // Render pruebas
  const listaPruebas = document.getElementById('listaPruebas');
  pruebas.forEach(p => {
    listaPruebas.innerHTML += `<li class='list-group-item d-flex justify-content-between'>${p}<button class='btn btn-sm btn-danger'>Eliminar</button></li>`;
  });

  function crearPrueba() {
    const nombre = prompt('Nombre de la prueba');
    if (nombre) listaPruebas.innerHTML += `<li class='list-group-item d-flex justify-content-between'>${nombre}<button class='btn btn-sm btn-danger'>Eliminar</button></li>`;
  }

  // Restricciones por rol
  if (rol === 'staff') {
    document.getElementById('menuPruebas').style.display = 'none';
    document.getElementById('menuConfig').style.display = 'none';
  }

  if (rol === 'paciente') {
    showSection('citas');
    document.getElementById('usuarios').style.display = 'none';
    document.getElementById('menuPruebas').style.display = 'none';
    document.getElementById('menuConfig').style.display = 'none';
  }
// ================= RESULTADOS ==================
const resultados = [
  { id: 1, paciente: '1020304050', examen: 'Hemograma', fecha: '2026-02-01', archivo: 'hemograma.pdf' },
  { id: 2, paciente: '1020304050', examen: 'Glucosa', fecha: '2026-02-03', archivo: 'glucosa.pdf' },
  { id: 3, paciente: '1122334455', examen: 'Colesterol', fecha: '2026-02-02', archivo: 'colesterol.pdf' }
];

function renderResultadosPaciente() {
  const cedula = localStorage.getItem('cedula');
  const contenedor = document.createElement('div');
  contenedor.innerHTML = `
    <h4 class='mt-4'>Mis Resultados</h4>
    <table class='table table-bordered'>
      <thead><tr><th>Examen</th><th>Fecha</th><th>Acci√≥n</th></tr></thead>
      <tbody id='tablaResultados'></tbody>
    </table>`;
  document.getElementById('dashboard').appendChild(contenedor);

  const tabla = contenedor.querySelector('#tablaResultados');
  resultados.filter(r => r.paciente === cedula)
    .forEach(r => {
      tabla.innerHTML += `
        <tr>
          <td>${r.examen}</td>
          <td>${r.fecha}</td>
          <td><a href='pdf/${r.archivo}' class='btn btn-sm btn-primary'>Descargar</a></td>
        </tr>`;
    });
}

// Admin / Staff gestionan resultados
function renderGestionResultados() {
  const contenedor = document.createElement('div');
  contenedor.innerHTML = `
    <h4 class='mt-4'>Gesti√≥n de Resultados</h4>
    <button class='btn btn-success mb-2' onclick='subirResultado()'>‚ûï Subir Resultado</button>
    <table class='table table-bordered'>
      <thead><tr><th>Paciente</th><th>Examen</th><th>Fecha</th><th>Acciones</th></tr></thead>
      <tbody id='tablaGestionResultados'></tbody>
    </table>`;
  document.getElementById('dashboard').appendChild(contenedor);

  const tabla = contenedor.querySelector('#tablaGestionResultados');
  resultados.forEach(r => {
    tabla.innerHTML += `
      <tr>
        <td>${r.paciente}</td>
        <td>${r.examen}</td>
        <td>${r.fecha}</td>
        <td>
          <button class='btn btn-sm btn-warning'>Editar</button>
          <button class='btn btn-sm btn-danger'>Eliminar</button>
        </td>
      </tr>`;
  });
}

function subirResultado() {
  alert('Aqu√≠ se conectar√° la subida de PDF al backend');
}

// ================= LOGICA DEL SISTEMA ==================

// ======= CITAS =======
let citasSistema = [
  { id: 1, paciente: 'Juan P√©rez', cedula: '1020304050', fecha: '2026-02-10', estado: 'Programada' },
  { id: 2, paciente: 'Ana L√≥pez', cedula: '1122334455', fecha: '2026-02-12', estado: 'Atendida' }
];

function listarCitas() {
  const tbody = document.getElementById('tablaCitas');
  tbody.innerHTML = '';
  citasSistema.forEach(c => {
    tbody.innerHTML += `
      <tr>
        <td>${c.paciente}</td>
        <td>${c.fecha}</td>
        <td>
          <button class='btn btn-sm btn-info'>Ver</button>
          <button class='btn btn-sm btn-warning'>Editar</button>
          <button class='btn btn-sm btn-danger' onclick='eliminarCita(${c.id})'>Eliminar</button>
        </td>
      </tr>`;
  });
}

function eliminarCita(id) {
  citasSistema = citasSistema.filter(c => c.id !== id);
  listarCitas();
}

// ======= USUARIOS =======
let usuariosSistema = [
  { cedula: '123456789', rol: 'admin' },
  { cedula: '987654321', rol: 'staff' },
  { cedula: '1020304050', rol: 'paciente' }
];

function listarUsuarios() {
  const tbody = document.getElementById('tablaUsuarios');
  tbody.innerHTML = '';
  usuariosSistema.forEach(u => {
    tbody.innerHTML += `
      <tr>
        <td>${u.cedula}</td>
        <td>${u.rol}</td>
        <td>
          <button class='btn btn-sm btn-info'>Ver</button>
          <button class='btn btn-sm btn-danger' onclick='eliminarUsuario("${u.cedula}")'>Eliminar</button>
        </td>
      </tr>`;
  });
}

function eliminarUsuario(cedula) {
  usuariosSistema = usuariosSistema.filter(u => u.cedula !== cedula);
  listarUsuarios();
}

// ======= PRUEBAS =======
let pruebasSistema = [
  { id: 1, nombre: 'Hemograma' },
  { id: 2, nombre: 'Glucosa' }
];

function listarPruebas() {
  const lista = document.getElementById('listaPruebas');
  lista.innerHTML = '';
  pruebasSistema.forEach(p => {
    lista.innerHTML += `
      <li class='list-group-item d-flex justify-content-between'>
        ${p.nombre}
        <div>
          <button class='btn btn-sm btn-warning'>Editar</button>
          <button class='btn btn-sm btn-danger' onclick='eliminarPrueba(${p.id})'>Eliminar</button>
        </div>
      </li>`;
  });
}

function crearPrueba() {
  const nombre = prompt('Nombre de la prueba');
  if (nombre) {
    pruebasSistema.push({ id: Date.now(), nombre });
    listarPruebas();
  }
}

function eliminarPrueba(id) {
  pruebasSistema = pruebasSistema.filter(p => p.id !== id);
  listarPruebas();
}

// ======= CONFIGURACION =======
function guardarConfiguracion() {
  alert('Configuraci√≥n guardada (simulado)');
}

// ======= CONSULTAS CLIENTES =======
let consultas = [
  { id: 1, nombre: 'Carlos', mensaje: 'Consulta sobre resultados' }
];

function listarConsultas() {
  console.log('Consultas:', consultas);
}

// ======= PACIENTE =======
function reservarCita() {
  alert('Cita reservada (simulado)');
}

// ======= INICIALIZACION =======
listarCitas();
listarUsuarios();
listarPruebas();

// ================= GRAFICAS ==================
new Chart(document.getElementById('chartResultados'), {
  type: 'line',
  data: {
    labels: ['Lun','Mar','Mi√©','Jue','Vie','S√°b','Dom'],
    datasets: [{
      label: 'Resultados',
      data: [12, 18, 15, 22, 19, 25, 30],
      tension: 0.4
    }]
  }
});

new Chart(document.getElementById('chartTipos'), {
  type: 'doughnut',
  data: {
    labels: ['Hemograma','Glucosa','Colesterol'],
    datasets: [{
      data: [45, 30, 25]
    }]
  }
});

// Mostrar resultados seg√∫n rol
if (rol === 'paciente') {
  renderResultadosPaciente();
} else {
  renderGestionResultados();
}

</script>
</body>
</html>
