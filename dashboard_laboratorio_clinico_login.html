<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard | Plus Laboratorio ClÃ­nico</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
/* ================= BASE ================= */
body{
  background:#f4f6f9;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
}
.hidden{display:none}
.card{
  border-radius:18px;
  border:none;
  box-shadow:0 10px 30px rgba(0,0,0,.06);
}

/* ================= SIDEBAR ================= */
.sidebar{
  width:260px;
  min-height:100vh;
  background:linear-gradient(180deg,#111827,#1f2937);
  color:#fff;
}
.sidebar h4{font-weight:700}
.sidebar a{
  color:#cbd5e1;
  text-decoration:none;
  display:flex;
  align-items:center;
  gap:8px;
  padding:12px 20px;
  border-radius:10px;
  margin:4px 10px;
  transition:.3s;
}
.sidebar a:hover,
.sidebar a.active{
  background:#2563eb;
  color:#fff;
}

/* ================= BUTTONS ================= */
.btn{
  border-radius:12px;
  font-weight:600;
  transition:.3s ease;
  box-shadow:0 6px 15px rgba(0,0,0,.08);
}
.btn:hover{
  transform:translateY(-2px);
  box-shadow:0 10px 20px rgba(0,0,0,.15);
}
.btn:active{
  transform:scale(.97);
}

/* Colores personalizados */
.btn-primary{
  background:linear-gradient(135deg,#2563eb,#1d4ed8);
  border:none;
}
.btn-success{
  background:linear-gradient(135deg,#16a34a,#15803d);
  border:none;
}
.btn-danger{
  background:linear-gradient(135deg,#dc2626,#b91c1c);
  border:none;
}
.btn-warning{
  background:linear-gradient(135deg,#f59e0b,#d97706);
  border:none;
  color:#000;
}
.btn-secondary{
  background:linear-gradient(135deg,#6b7280,#4b5563);
  border:none;
}
.btn-outline{
  background:#fff;
  border:2px dashed #2563eb;
  color:#2563eb;
}

/* ================= TOAST ================= */
.toast-success{background:#16a34a}
.toast-danger{background:#dc2626}
.toast-warning{background:#f59e0b;color:#000}

/* ================= TABLE ================= */
.table{
  background:#fff;
  border-radius:14px;
  overflow:hidden;
}
.table th{
  background:#f1f5f9;
  font-weight:700;
}
</style>
</head>

<body>

<div class="d-flex">

<!-- SIDEBAR -->
<div class="sidebar">
<h4 class="text-center py-4">ğŸ”¬ Plus Lab</h4>
<a onclick="showSection('dashboard',this)" class="active">ğŸ“Š Dashboard</a>
<a onclick="showSection('citas',this)">ğŸ“… Citas</a>
<a onclick="showSection('usuarios',this)">ğŸ‘¥ Usuarios</a>
<a onclick="showSection('pruebas',this)">ğŸ§ª Pruebas</a>
<a onclick="showSection('reportes',this)">ğŸ“Š Reportes</a>
<a onclick="showSection('config',this)">âš™ï¸ ConfiguraciÃ³n</a>
<a onclick="exportarPDF()">ğŸ“„ Exportar PDF</a>
<a onclick="logout()">ğŸšª Cerrar sesiÃ³n</a>
</div>

<!-- CONTENIDO -->
<div class="flex-fill p-4">

<!-- DASHBOARD -->
<div id="dashboard" class="section">
<h3 class="fw-bold">Bienvenido</h3>
<p id="infoUser"></p>

<div class="card p-4 mb-3">
<h6 class="fw-bold">ğŸš¨ Notificaciones</h6>
<div class="d-flex gap-2 flex-wrap">
<button class="btn btn-success" onclick="notificar('success','Proceso exitoso')">âœ” Success</button>
<button class="btn btn-danger" onclick="notificar('danger','Registro eliminado')">ğŸ—‘ Eliminar</button>
<button class="btn btn-warning" onclick="notificar('warning','Registro modificado')">âœ Modificar</button>
</div>
</div>

<div class="card p-4 mb-3">
<h6 class="fw-bold">ğŸ§¾ Historial</h6>
<ul id="historial" class="list-group list-group-flush"></ul>
</div>

<div class="row">
<div class="col-md-6"><canvas id="chartResultados"></canvas></div>
<div class="col-md-6"><canvas id="chartTipos"></canvas></div>
</div>
</div>

<!-- CITAS -->
<div id="citas" class="section hidden">
<h4 class="fw-bold">ğŸ“… Citas</h4>
<button class="btn btn-primary mb-3" onclick="crearCita()">â• Nueva Cita</button>
<table class="table"><tbody id="tablaCitas"></tbody></table>
</div>

<!-- USUARIOS -->
<div id="usuarios" class="section hidden">
<h4 class="fw-bold">ğŸ‘¥ Usuarios</h4>
<button class="btn btn-primary mb-3" onclick="crearUsuario()">â• Nuevo Usuario</button>
<table class="table"><tbody id="tablaUsuarios"></tbody></table>
</div>

<!-- PRUEBAS -->
<div id="pruebas" class="section hidden">
<h4 class="fw-bold">ğŸ§ª Pruebas</h4>
<button class="btn btn-success mb-3" onclick="crearPrueba()">â• Nueva Prueba</button>
<ul id="listaPruebas" class="list-group"></ul>
</div>

<!-- REPORTES -->
<div id="reportes" class="section hidden">
<div class="card p-4">
<h4 class="fw-bold">ğŸ“Š Reportes Avanzados</h4>
<div class="row g-3 mb-3">
<div class="col-md-3">
<select id="filtroTipo" class="form-select">
<option value="">Todos</option>
<option value="cita">Citas</option>
<option value="prueba">Pruebas</option>
</select>
</div>
<div class="col-md-3">
<input type="date" id="filtroFecha" class="form-control">
</div>
<div class="col-md-3">
<button class="btn btn-primary w-100" onclick="generarReporte()">Generar</button>
</div>
<div class="col-md-3">
<button class="btn btn-danger w-100" onclick="exportarReportePDF()">PDF</button>
</div>
</div>
<table class="table">
<thead>
<tr><th>Tipo</th><th>Detalle</th><th>Fecha</th><th>Lab</th><th>Usuario</th></tr>
</thead>
<tbody id="tablaReportes"></tbody>
</table>
</div>
</div>

<!-- CONFIG -->
<div id="config" class="section hidden">
<h4 class="fw-bold">âš™ï¸ ConfiguraciÃ³n</h4>
<button class="btn btn-secondary" onclick="notificar('warning','ConfiguraciÃ³n guardada')">Guardar</button>
</div>

</div>
</div>

<!-- TOAST -->
<div class="toast-container position-fixed top-0 end-0 p-3">
<div id="toast" class="toast text-white">
<div class="toast-body" id="toastMsg"></div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ================= AUTH ================= */
function login(u){localStorage.setItem('user',JSON.stringify(u));location.reload()}
function logout(){localStorage.clear();location.reload()}
const user=JSON.parse(localStorage.getItem('user'))||{nombre:'Admin',rol:'admin',lab:'Sede Central'}
localStorage.setItem('user',JSON.stringify(user))
infoUser.innerText=`Usuario: ${user.nombre} | Rol: ${user.rol} | Lab: ${user.lab}`

/* ================= ROLES ================= */
const PERMISOS={admin:['dashboard','citas','usuarios','pruebas','reportes','config'],staff:['dashboard','citas','pruebas','reportes']}
function showSection(id,el){
 if(!PERMISOS[user.rol].includes(id)) return notificar('danger','Acceso denegado')
 document.querySelectorAll('.section').forEach(s=>s.classList.add('hidden'))
 document.getElementById(id).classList.remove('hidden')
 document.querySelectorAll('.sidebar a').forEach(a=>a.classList.remove('active'))
 el.classList.add('active')
}

/* ================= TOAST ================= */
function notificar(tipo,msg){
 toast.className=`toast toast-${tipo} text-white`
 toastMsg.innerText=msg
 guardarHistorial(msg)
 new bootstrap.Toast(toast,{delay:2200}).show()
}

/* ================= HISTORIAL ================= */
function guardarHistorial(msg){
 const h=JSON.parse(localStorage.getItem('historial'))||[]
 h.unshift({msg,fecha:new Date().toLocaleString(),user:user.nombre})
 localStorage.setItem('historial',JSON.stringify(h.slice(0,20)))
 renderHistorial()
}
function renderHistorial(){
 historial.innerHTML=''
 ;(JSON.parse(localStorage.getItem('historial'))||[]).forEach(i=>{
  historial.innerHTML+=`<li class="list-group-item">${i.msg}<br><small>${i.fecha} - ${i.user}</small></li>`
 })
}
renderHistorial()

/* ================= API ================= */
const API={get:k=>JSON.parse(localStorage.getItem(k))||[],set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))}
let citas=API.get('citas'),usuarios=API.get('usuarios'),pruebas=API.get('pruebas')

/* ================= CRUD ================= */
function crearCita(){citas.push({paciente:prompt('Paciente'),fecha:prompt('Fecha'),lab:user.lab});API.set('citas',citas);notificar('success','Cita creada')}
function crearUsuario(){usuarios.push({nombre:prompt('Nombre'),rol:prompt('Rol'),lab:prompt('Lab')});API.set('usuarios',usuarios);notificar('success','Usuario creado')}
function crearPrueba(){pruebas.push(prompt('Prueba'));API.set('pruebas',pruebas);notificar('success','Prueba creada')}

/* ================= REPORTES ================= */
function generarReporte(){
 const t=filtroTipo.value,f=filtroFecha.value
 let d=[]
 citas.forEach(c=>d.push({tipo:'Cita',detalle:c.paciente,fecha:c.fecha,lab:c.lab,usuario:user.nombre}))
 pruebas.forEach(p=>d.push({tipo:'Prueba',detalle:p,fecha:'-',lab:user.lab,usuario:user.nombre}))
 d=d.filter(r=>(!t||r.tipo.toLowerCase().includes(t))&&(!f||r.fecha===f))
 tablaReportes.innerHTML=d.length?d.map(r=>`<tr><td>${r.tipo}</td><td>${r.detalle}</td><td>${r.fecha}</td><td>${r.lab}</td><td>${r.usuario}</td></tr>`).join(''):`<tr><td colspan="5" class="text-center">Sin resultados</td></tr>`
}
function exportarReportePDF(){html2pdf().from(document.getElementById('reportes')).save('reporte.pdf')}

/* ================= CHARTS ================= */
new Chart(chartResultados,{type:'line',data:{labels:['L','M','X','J','V'],datasets:[{data:[10,20,15,25,30]}]}})
new Chart(chartTipos,{type:'doughnut',data:{labels:['Hemo','Glu','Col'],datasets:[{data:[40,35,25]}]}})
</script>

</body>
</html>
