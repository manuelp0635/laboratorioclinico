<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dashboard | Plus Laboratorio ClÃ­nico</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- ChartJS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{background:#f4f6f9}
.sidebar{width:260px;min-height:100vh;background:#1f2937;color:#fff}
.sidebar a{color:#cbd5e1;text-decoration:none;display:block;padding:12px 20px;cursor:pointer}
.sidebar a:hover{background:#111827;color:#fff}
.hidden{display:none}
.card{border-radius:16px}
.btn-orange{background:#ff9800;color:#fff}
.btn-orange:hover{background:#fb8c00}
.fade-slide{animation:fadeSlide .6s ease forwards}
@keyframes fadeSlide{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.toast-success{background:#198754}
.toast-danger{background:#dc3545}
.toast-warning{background:#ffc107;color:#000}
.toast-edit{background:#ff9800}
</style>
</head>

<body>

<div class="d-flex">

<!-- SIDEBAR -->
<div class="sidebar">
<h4 class="text-center py-3">ğŸ”¬ Plus Lab</h4>
<a onclick="showSection('dashboard')">ğŸ“Š Dashboard</a>
<a onclick="showSection('citas')">ğŸ“… Citas</a>
<a onclick="showSection('usuarios')">ğŸ‘¥ Usuarios</a>
<a onclick="showSection('pruebas')">ğŸ§ª Pruebas</a>
<a onclick="showSection('config')">âš™ï¸ ConfiguraciÃ³n</a>
<a onclick="logout()">ğŸšª Cerrar sesiÃ³n</a>
</div>

<!-- CONTENIDO -->
<div class="flex-fill p-4">

<!-- DASHBOARD -->
<div id="dashboard" class="section">
<h3 class="fade-slide">Bienvenido al Sistema</h3>
<p class="fade-slide">Panel de control del Laboratorio ClÃ­nico Plus.</p>

<div class="card p-3 fade-slide">
<h6>ğŸš¨ Notificaciones de Emergencia</h6>
<div class="row g-2">
<div class="col-6 col-md-3"><button class="btn btn-success w-100" onclick="notificar('success')">Success</button></div>
<div class="col-6 col-md-3"><button class="btn btn-danger w-100" onclick="notificar('danger')">Danger</button></div>
<div class="col-6 col-md-3"><button class="btn btn-warning w-100" onclick="notificar('modify')">Modify</button></div>
<div class="col-6 col-md-3"><button class="btn btn-orange w-100" onclick="notificar('edit')">Editar</button></div>
</div>
</div>

<div class="card p-3 mt-3 fade-slide">
<h6>ğŸ§¾ Historial de Alertas</h6>
<ul id="historial" class="list-group list-group-flush"></ul>
</div>

<div class="row g-4 mt-4">
<div class="col-md-7">
<div class="card p-3 fade-slide">
<h6>Resultados Realizados</h6>
<canvas id="chartResultados"></canvas>
</div>
</div>
<div class="col-md-5">
<div class="card p-3 fade-slide">
<h6>Resultados por Tipo</h6>
<canvas id="chartTipos"></canvas>
</div>
</div>
</div>
</div>

<!-- CITAS -->
<div id="citas" class="section hidden">
<h4>GestiÃ³n de Citas</h4>
<button class="btn btn-primary mb-2" onclick="crearCita()">â• Nueva Cita</button>
<table class="table table-bordered">
<tbody id="tablaCitas"></tbody>
</table>
</div>

<!-- USUARIOS -->
<div id="usuarios" class="section hidden">
<h4>Usuarios</h4>
<button class="btn btn-primary mb-2" onclick="crearUsuario()">â• Nuevo Usuario</button>
<table class="table table-bordered">
<tbody id="tablaUsuarios"></tbody>
</table>
</div>

<!-- PRUEBAS -->
<div id="pruebas" class="section hidden">
<h4>Pruebas</h4>
<button class="btn btn-success mb-2" onclick="crearPrueba()">â• Nueva Prueba</button>
<ul id="listaPruebas" class="list-group"></ul>
</div>

<!-- CONFIG -->
<div id="config" class="section hidden">
<h4>ConfiguraciÃ³n</h4>
<button class="btn btn-secondary" onclick="notificar('modify')">Guardar Cambios</button>
</div>

</div>
</div>

<!-- MODAL -->
<div class="modal fade" id="modalNotif">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<div class="modal-header">
<h5 id="modalTitulo"></h5>
<button class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body" id="modalMensaje"></div>
<div class="modal-footer">
<small id="estadoRed"></small>
<button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
</div>
</div>
</div>
</div>

<!-- TOAST -->
<div class="toast-container position-fixed top-0 end-0 p-3">
<div id="toast" class="toast text-white">
<div class="toast-body" id="toastMsg"></div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ================= UTIL ================= */
function showSection(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.add('hidden'))
  document.getElementById(id).classList.remove('hidden')
}
function logout(){
  localStorage.clear()
  location.href='login.html'
}

/* ================= TOAST + MODAL ================= */
const tipos={
  success:{t:'âœ” Ã‰xito',m:'AcciÃ³n realizada',c:'success'},
  danger:{t:'ğŸš¨ Eliminado',m:'Registro eliminado',c:'danger'},
  modify:{t:'âš  Modificado',m:'Registro actualizado',c:'warning'},
  edit:{t:'âœ Editar',m:'Editando registro',c:'edit'}
}

function notificar(tipo,msg){
  modalTitulo.innerText=tipos[tipo].t
  modalMensaje.innerText=msg||tipos[tipo].m
  estadoRed.innerText=navigator.onLine?'ğŸŒ Conectado':'ğŸ“´ Sin conexiÃ³n'
  guardarHistorial(msg||tipos[tipo].m,tipo)
  toast.className=`toast text-white toast-${tipo}`
  toastMsg.innerText=msg||tipos[tipo].m
  new bootstrap.Toast(toast,{delay:3000}).show()
  new bootstrap.Modal(modalNotif).show()
}

/* ================= HISTORIAL ================= */
function guardarHistorial(msg,tipo){
  const h=JSON.parse(localStorage.getItem('historial'))||[]
  h.unshift({msg,tipo,fecha:new Date().toLocaleString()})
  localStorage.setItem('historial',JSON.stringify(h.slice(0,20)))
  renderHistorial()
}
function renderHistorial(){
  const h=JSON.parse(localStorage.getItem('historial'))||[]
  historial.innerHTML=''
  h.forEach(i=>{
    historial.innerHTML+=`
      <li class="list-group-item">
        <strong>${i.msg}</strong><br>
        <small>${i.fecha}</small>
      </li>`
  })
}
renderHistorial()

/* ================= STORAGE ================= */
function getData(key){
  return JSON.parse(localStorage.getItem(key))||[]
}
function setData(key,data){
  localStorage.setItem(key,JSON.stringify(data))
}

/* ================= CITAS ================= */
let citas=getData('citas')

function renderCitas(){
  tablaCitas.innerHTML=''
  citas.forEach((c,i)=>{
    tablaCitas.innerHTML+=`
    <tr>
      <td>${c.paciente}</td>
      <td>${c.fecha}</td>
      <td>
        <button class="btn btn-sm btn-warning" onclick="editarCita(${i})">Editar</button>
        <button class="btn btn-sm btn-danger" onclick="eliminarCita(${i})">Eliminar</button>
      </td>
    </tr>`
  })
}

function crearCita(){
  const paciente=prompt('Paciente')
  const fecha=prompt('Fecha (YYYY-MM-DD)')
  if(!paciente||!fecha) return
  citas.push({paciente,fecha})
  setData('citas',citas)
  renderCitas()
  notificar('success','Cita creada')
}

function editarCita(i){
  const p=prompt('Paciente',citas[i].paciente)
  const f=prompt('Fecha',citas[i].fecha)
  if(!p||!f) return
  citas[i]={paciente:p,fecha:f}
  setData('citas',citas)
  renderCitas()
  notificar('modify','Cita modificada')
}

function eliminarCita(i){
  if(!confirm('Eliminar cita?')) return
  citas.splice(i,1)
  setData('citas',citas)
  renderCitas()
  notificar('danger','Cita eliminada')
}

/* ================= USUARIOS ================= */
let usuarios=getData('usuarios')

function renderUsuarios(){
  tablaUsuarios.innerHTML=''
  usuarios.forEach((u,i)=>{
    tablaUsuarios.innerHTML+=`
    <tr>
      <td>${u.nombre}</td>
      <td>${u.rol}</td>
      <td>
        <button class="btn btn-sm btn-warning" onclick="editarUsuario(${i})">Editar</button>
        <button class="btn btn-sm btn-danger" onclick="eliminarUsuario(${i})">Eliminar</button>
      </td>
    </tr>`
  })
}

function crearUsuario(){
  const nombre=prompt('Nombre')
  const rol=prompt('Rol (admin/staff/paciente)')
  if(!nombre||!rol) return
  usuarios.push({nombre,rol})
  setData('usuarios',usuarios)
  renderUsuarios()
  notificar('success','Usuario creado')
}

function editarUsuario(i){
  const n=prompt('Nombre',usuarios[i].nombre)
  const r=prompt('Rol',usuarios[i].rol)
  if(!n||!r) return
  usuarios[i]={nombre:n,rol:r}
  setData('usuarios',usuarios)
  renderUsuarios()
  notificar('modify','Usuario modificado')
}

function eliminarUsuario(i){
  if(!confirm('Eliminar usuario?')) return
  usuarios.splice(i,1)
  setData('usuarios',usuarios)
  renderUsuarios()
  notificar('danger','Usuario eliminado')
}

/* ================= PRUEBAS ================= */
let pruebas=getData('pruebas')

function renderPruebas(){
  listaPruebas.innerHTML=''
  pruebas.forEach((p,i)=>{
    listaPruebas.innerHTML+=`
    <li class="list-group-item d-flex justify-content-between">
      ${p}
      <div>
        <button class="btn btn-sm btn-warning" onclick="editarPrueba(${i})">Editar</button>
        <button class="btn btn-sm btn-danger" onclick="eliminarPrueba(${i})">Eliminar</button>
      </div>
    </li>`
  })
}

function crearPrueba(){
  const nombre=prompt('Nombre de la prueba')
  if(!nombre) return
  pruebas.push(nombre)
  setData('pruebas',pruebas)
  renderPruebas()
  notificar('success','Prueba creada')
}

function editarPrueba(i){
  const n=prompt('Nombre',pruebas[i])
  if(!n) return
  pruebas[i]=n
  setData('pruebas',pruebas)
  renderPruebas()
  notificar('modify','Prueba modificada')
}

function eliminarPrueba(i){
  if(!confirm('Eliminar prueba?')) return
  pruebas.splice(i,1)
  setData('pruebas',pruebas)
  renderPruebas()
  notificar('danger','Prueba eliminada')
}

/* ================= INIT ================= */
renderCitas()
renderUsuarios()
renderPruebas()

/* ================= CHARTS ================= */
new Chart(chartResultados,{
  type:'line',
  data:{labels:['L','M','M','J','V','S','D'],datasets:[{data:[12,18,15,22,19,25,30],tension:.4}]}
})
new Chart(chartTipos,{
  type:'doughnut',
  data:{labels:['Hemograma','Glucosa','Colesterol'],datasets:[{data:[45,30,25]}]}
})
</script>

</body>
</html>
